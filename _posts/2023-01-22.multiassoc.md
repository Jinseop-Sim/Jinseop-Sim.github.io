---
layout: post
title: "다대다 관계와 조회 Query에 대한 고찰"
categories: ToyProject
tags: [devops]
author:
  - Jinseop Sim
---
프로젝트를 진행하던 중, 큰 고민을 하게 됐다.  
공동 구매기능을 구현하던 중, 회원이 참여 중인 글을 과연 어떻게 불러올 지가 고민이었다.  

우리 프로젝트는 회원과 참여 중인 공동구매가 ```M:N(다대다)``` 관계를 갖는다.  
회원은 여러 글에 참여할 수 있으며, 공동 구매는 여러 회원이 참여하기 때문이다.  
그래서 둘 사이에 ```Intersaction``` Table을 만들어 풀어 놓았는데,  
회원의 개인 마이페이지를 만드는 과정에서 참여 중인 글을 불러오는 기능이 있는데, 여기서 고민이 생겼다.  

```Intersaction``` Table에는 회원의 ID와 공동 구매 글의 ID만이 저장되어 있다.  
그렇다면 매번 글을 불러올 때마다 ID에 맞는 글을 Query를 날려 불러와야 하는가?  

### N+1 Query
현재 나는, 아래의 사진과 같이 ```Member``` Entity에 배열을 선언 해놓았다.  

<img width="713" alt="KakaoTalk_20230125_184932827" src="https://user-images.githubusercontent.com/71700079/214566423-24b69ce8-33c1-4ce7-a150-61bcaedaf13b.png">  
<img width="705" alt="KakaoTalk_20230125_184952339" src="https://user-images.githubusercontent.com/71700079/214566429-52670a3e-7f01-47b4-9acd-dd5bd89f01a3.png">  

내가 어떤 글에 참여를 하게 되면, 해당 배열에 해당 글의 객체가 추가가 되는데,  
중요한 것은 이 때, 글의 객체가 아닌 ```Intersaction```을 저장하고 있다는 것이다.  

그렇다면 만약 내가 참여중인 글 목록을 Client Side로 보내주고 싶다면?  
```Intersaction``` 마다 __글 ID__ 가 저장이 되어 있으니,  
```Intersaction.getId().getTitle()``` 과 같이 Method Chain을 이용하면 될까?  
만약 이렇게 Query를 날린다면, Id마다 Query가 날아가는 __N+1 Query__ 현상이 발생할 것이다.  


### Fetch Join
