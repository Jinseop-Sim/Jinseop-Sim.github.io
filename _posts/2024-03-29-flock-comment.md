---
layout: post
title: "댓글의 대댓글 기능 구현하기"
categories: ToyProject
tags: [develop]
author:
  - Jinseop Sim
---
기존의 ```Flock project```에서는 댓글 기능 밖에 없었다.  
그래서 대댓글 기능을 한 번 추가해보려고 한다.  

### Entity
먼저, ```Entity```를 어떤식으로 구성해야 할까?  
자식 댓글을 보관하기 위한 새 테이블을 만들어야 할까?  
그럴 필요는 없다고 생각된다.  

우선 나는 인스타그램과 같이 깊이가 하나인 대댓글을 구현할 것이다.  
바로 아래의 형태와 같이 말이다.  

<img width="370" alt="스크린샷 2024-03-29 오후 2 36 10" src="https://github.com/Jinseop-Sim/Jinseop-Sim.github.io/assets/71700079/a5aeb4a8-1ec5-451c-b89b-128c61a81242">  

그럼 우선 ```깊이``` 개념을 신경쓰지 않아도 된다.  
단순히 ```DB```에서 현재 댓글을 ```부모```로 가진 댓글을 모두 가져오면 된다.  
그러기 위해서, 우선 필드에 ```부모 댓글``` 필드를 만들어 주었다.  

<img width="331" alt="스크린샷 2024-03-29 오후 2 45 07" src="https://github.com/Jinseop-Sim/Jinseop-Sim.github.io/assets/71700079/ac97b8d5-f327-4f00-92f1-95a8507f9723">  

이후 댓글을 모두 조회해 올 때를 생각해서 위와 같이 선언했다.  
게시글을 조회할 때, ```댓글, 대댓글```이 모두 한 번에 조회되어야 한다.  

#### 양방향 관계?
그 과정속에서 고민이 하나 생겼다.  
과연 ```다대일, 일대다```의 경우 양방향 관계를 유지하는 것이 좋은가?  

<img width="676" alt="스크린샷 2024-03-29 오후 2 53 25" src="https://github.com/Jinseop-Sim/Jinseop-Sim.github.io/assets/71700079/92d5199c-cd4b-4476-ae34-45ec121f2ead">  
<img width="434" alt="스크린샷 2024-03-29 오후 2 53 39" src="https://github.com/Jinseop-Sim/Jinseop-Sim.github.io/assets/71700079/8567a407-405f-48e6-9a06-e9c8a9e61074">  

위와 같이 ```Member, Webtoon``` 엔티티에는 댓글 목록이 들어있다.  
이후 댓글을 조회할 때 DB를 거치지 않기 위해, 저장시켜 놓으려고 했다.  
이런 양방향 관계는 좋지 않은 것일까?  

양방향으로 유지하는 경우, 양쪽 ```Entity```에 객체를 꼭 추가 해주어야 한다.  
이 부분을 누락할 위험성 때문에 안좋다고 볼 수도 있겠다.  
하지만 추후 게시글 삭제, 회원 탈퇴 시에 연관된 객체를 모두 한 번에 지워야 한다.  
그런 경우에는 양방향으로 걸고 ```CASCADE``` 옵션을 사용하면 매우 편리하다.  

나는 양방향으로 선언하고 사용해도 무방하다고 생각한다.  
