---
layout: post
title: "[SpringBoot] Spring Security & JWT"
categories: Springboot
tags: [java]
author:
  - Jinseop Sim
toc: true
---
SpringBoot로 개발을 하다 보면, 로그인 기능을 구현할 일이 분명히 생긴다.  
우리는 일반적으로 로그인 기능을 구현할 때 아래의 3가지 방법을 사용한다.

1. Cookie를 이용한 로그인 방법
  - 값을 그대로 보내기 때문에 보안에 가장 취약하다!
  - 쿠키엔 용량 제한이 존재해서 많은 정보를 담을 수 없다.
  - 쿠키의 크기가 커지면, 서버에 부하가 심해진다.
2. Session을 이용한 로그인 방법
  - 쿠키가 노출이 되더라도, Session ID 자체는 개인정보가 없어 괜찮다.
  - 하지만 해커가 Session ID를 탈취한다면, 해당 클라이언트로 위장이 가능하다!
  - 서버 저장소를 쓰므로 요청이 많아지면 서버에 부하가 심해진다.
3. Token을 이용한 로그인 방법
  - Data의 길이가 길어 인증 요청이 많으면 네트워크에 부하가 심해진다.
  - Payload가 암호화되지 않기 때문에 중요 정보는 담을 수 없다.
  - 탈취 당하면 대처가 어렵다!

위의 3가지 중 Token을 이용한 방법이 바로 JWT가 되겠다.  
JWT(JSON Web Token), 즉 JSON의 형태로 Token을 발급해주는 방식인 것이다.  

### Authorization Header
먼저, 컴퓨터 보안에서의 인증은 아래의 두 가지가 있다.  

1. Authentication : 신분을 제시한 사람이 과연 본인이 맞는가?
2. Authorization : 인증을 받은 사람이 해당 API를 호출할 권한이 있는가?

보통 Token은, Authorization을 위해 Request Header에  
```Authorization : <type> <credentials>``` 의 형태로 담겨져 온다.  

- Type
  - Basic : 사용자 ID/PW를 Base64로 인코딩한 값을 Token으로 쓴다.
  - Bearer : JWT나 OAuth에 대해 토큰을 쓴다.
  - Digest : 서버에서 난수 데이터 문자열을 보낸다.
    - Client는 사용자 정보와 Nonce를 포함한 해쉬 값으로 응답.
  - HOBA : 전자 서명을 기반으로 한다.
  - Mutual : 암호를 이용한 Client-Server 상호 인증
  - AWS4-HMAC-SHA256 : AWS 전자 서명 기반 인증

당연히 우리는 Bearer Type을 통해서 JWT를 이용할 것이다.  

### JWT의 구성

- Access Token
  - ID의 권한을 인증하는 Token이다.
  - 만료 기한이 존재하며, 보안을 위해 기한을 짧게 가져간다.
- Refresh Token
  - Access Token 만료 시, 재발급에 대해 인가를 담당하는 Token이다.

### JWT 로그인 방식
![JWT 동작고자ㅓㅇ](https://user-images.githubusercontent.com/71700079/192800728-f7b1cb72-20f7-4235-87da-86a4850ded23.PNG)  

위 사진과 같이 로그인 과정이 진행된다.  

아까 Token은 탈취 당하면 별다른 대처가 불가능하다고 했다.  
그래서 우리는 Token을 2개로 분리해서 사용하는 것이다!  
Access Token은 탈취를 해도 사용할 수 없도록 만료 기한을 짧게 건다.  
Refresh Token은 탈취가 되어선 안되도록 관리를 해야하는 재발급 인가 토큰이다.  
Access Token이 만료되었을 때, Refresh Token과 함께 제시해서 일치하면, Access Token을 재발급 해주는 방식이다!  

사용자가 로그아웃을 했을 시에는, Refresh Token을 파기하여 다시 로그인 할 때 발급을 새로 해준다.

### Spring Security
Spring Security는 Spring에서 손 쉬운 인증을 할 수 있도록 제공해주는 프레임워크이다.  

__Filter__ 라는 핵심 요소를 통해서 인증과 인가 처리를 대부분 진행한다.  
