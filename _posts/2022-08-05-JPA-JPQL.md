---
layout: post
title: "스프링 JPA - JPQL"
categories: Springboot
tags: [java]
author:
  - Jinseop Sim
toc: true
---
JPQL(Java Persistence Query Language)란?  
Java에서 사용하는 객체 지향 쿼리 언어이다.  
따라서 Table 대상 쿼리가 아닌 Entity 객체 대상 쿼리문이다.  

JPQL은 SQL을 추상화해서, 특정 DB에 의존하지 않는다.  
마지막에 SQL로 변환이 되어 쿼리가 나간다.  

### 기본 JPQL 문법
[사진 첨부]

- 기본적으로 ```em.createQeury()```를 사용한다.
  - ```em.createQuery()``` 를 날리면, 영속 Context가 관리하게 된다.
- Entity와 Attribute는 대소문자를 구분한다.
- JPQL Query 키워드는 대소문자를 구분하지 않는다.
- Entity 이름을 사용하며, Table 이름을 쓰는 것이 아니다!
- 별칭(Alias)은 필수! (AS 키워드 생략 가능)
- 집합과 정렬이 모두 사용 가능하다.
  - COUNT, SUM, AVG, MAX, MIN
  - GROUP BY, HAVING
- Type
  - TypeQeury : 반환 타입이 명확할 때 사용한다.
  - Query : 반환 타입이 명확하지 않을 때 사용한다.
- 결과 조회 API
  - ```getResultList()``` : Collection으로 반환한다. Loop문으로 접근 가능.
    - 결과가 없으면, 빈 Collection이 반환된다.
  - ```getSingleResult()``` : 결과가 정확히 하나만 나온다.
    - 결과가 없다면? ```NoResultException```이 터진다.
    - 결과가 둘 이상이면? ```NonUniqueResultException```이 터진다.

### 프로젝션
```SELECT``` Clause에 조회할 대상을 지정하는 행위이다.  

- 프로젝션 대상 : Entity, Embedded, Scalar(기본 값 타입)
- SQL과 마찬가지로 ```DISTINCT```로 중복을 제거할 수 있다.

#### 프로젝션 : 여러 종류의 값 조회
- ```SELECT m.username, m.age FROM Member m``` 이런 Query가 있다.
  - ```getResultList()```를 하게 된다면, 어떤 Type에 값을 담아야 할까?

- new 명령어로 조회를 하자!
  - 단순 값을 DTO로 바로 조회한다.
  - Query의 결과를 선언된 DTO의 형태로 받아 저장한다.
  - DTO에는 Parameter와 Type이 일치하는 생성자가 필요하다.

[사진 첨부]

### 페이징
페이징이란, SQL에서의 ```LIMIT, OFFSET```과 같은 역할이다.  
조회하는 객체의 수를 제한할 수 있는 Query이다.

```.setFirstResult(integer)```과 ```.setMaxResults(integer)```로 제어한다.  

### 조인