---
layout: post
title: "랭킹 서비스 개발 (w. Redis)"
categories: ToyProject
tags: [develop]
author:
  - Jinseop Sim
---
프로젝트에 어떤 기능이 좀 더 필요할까 고민해보니,  
문득 웹툰 별로 조회수가 필요할 것 같다는 생각이 들었다.  
조회수를 생각하다보니, 조회수에 따른 랭킹도 알 수 있으면 좋을 것 같았다.  

그래서, 이번에는 조회수와 랭킹 시스템을 한 번 만들어보도록 할 것이다!  

### 조회수
웹툰 별로 조회수를 어떻게 저장하고 불러올 수 있을까?  

간단하게 생각했을 때, ```DB```에 컬럼을 만들 수 있을 것이다.  
```DB```에 새로운 ```views``` 컬럼을 만들어 저장을 하는 것이다.  
하지만, ```DB```에 저장하는 것이 과연 효율적일까?  

조회수가 올라가고, 조회수를 조회하는 시나리오를 생각해보자.  
사용자가 웹툰 상세 페이지를 조회하면, 조회수가 올라가야 한다.  
아래와 같이 도식화 할 수 있을 것 같다.  

<img width="422" alt="스크린샷 2024-04-03 오후 6 01 34" src="https://github.com/Jinseop-Sim/Jinseop-Sim.github.io/assets/71700079/47fe6457-8646-4649-9ca0-242b2f6f42cf">  

Increment 동작이 수행된다는 것은, ```UPDATE``` 쿼리가 날아간다는 것이다.  
즉, 사용자가 상세 페이지를 조회할 때마다 ```UPDATE``` 쿼리가 날아가게 된다.  
그럼 매우 많은 사용자가 서비스를 사용하게 된다면?  
이는 분명히 성능 저하를 초래할 수 밖에 없을 것이다.  

또한, 랭킹 시스템을 적용하기 위해서는 매번 DB에 가서 조회수를 확인해야 할 것이다.  
웹툰들의 조회수를 확인한 뒤, 상위 랭킹의 웹툰을 추려 가공하는 작업을 반복해야 한다.  
그 과정에서 매번 조회 쿼리가 날아가게 될 것이고, 이 또한 성능 저하의 위험이 있다.  
따라서 나는 다른 저장소를 사용해 조회수를 적용해보려고 한다.  

바로 In-Memory DB인 Redis!  

### 왜 Redis?
Spring에서 사용되는 In-Memory DB는 보통 두가지를 꼽는다.  
바로 ```Memcached```와 ```Redis```이다.  
굳이 ```Redis```를 내가 사용하고자 하는 이유는 자료구조의 다양성 때문이다.  
물론 ```Redis```는 ```Pub / Sub``` 기능이 있는 등 더 다양한 기능을 지원하기도 한다.  

In-Memory DB의 장점은, 디스크에 접근하지 않는다는 점이다.  
DB에 접근하는 것은 디스크에 접근하는 것과 동일한 동작이라 비용이 크다.  
하지만 ```Redis```나 ```Memcached```는 메모리에 곧바로 쓰기 때문에 비용이 적다.  
즉, 조회 및 삽입 시간이 매우 빠르다!  

### Sorted Set in Redis
우선 랭킹 시스템을 적용하려면, 정렬이 자동으로 되는 자료구조가 필요하다.  
마치 ```C++```의 ```Set, Map```과 같이 말이다.  
그런 점에서 ```Redis```에서 지원하는 ```Sorted Set```을 사용하면 될 것 같았다.  
